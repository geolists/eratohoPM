;アイテムインターフェース改良用の関数郡
;アイテムの価格、詳細説明等は「PRINT_SHOP_ITEM.ERB」に格納されています

@PRINT_ITEMMENU
#DIM CLOTHE, 2
#DIM ITEM_COST,1
#DIM L_LOCAL, 1

$TOP
A = 0
DRAWLINE
PRINTL [0] - 買う
IF !FLAG:王宮追放
	PRINTL [1] - 闇市
ENDIF
PRINTL [2] - 衣装を売る
PRINTL [3] - 魂の店
PRINTL [4] - 裁縫屋
PRINTL [9] - 戻る
$INPUT_LOOP_1
INPUT

IF RESULT == 0 && TALENT:娼婦
	$TOP_2
	DRAWLINE
	PRINTL ～～怪しい店～～
	PRINTL 店主「いらっしゃいませ
	IF !FLAG:怪しい店主との親密度
		PRINTL 　　　初見でございますか……。
		PRINTL 　　　ここは王宮の目が入らぬ地、安心して買い物をしていってください……」
		FLAG:怪しい店主との親密度 = 1
	ELSE
		PRINTL 　　　そこの少女どこかで見たような……
		PRINTL 　　　まさかね、王族のお姫様がこんなに艶っぽい仕草と
		PRINTL 　　　体つきをしている訳がありませんし」
	ENDIF
	PRINTL 
	PRINTL [0] 衣装　　　　　　　表には流通しない服を取り揃えております
	PRINTL [1] 装飾品　　　　　　あなたに似合うかどうかは分かりませんが……
	PRINTL [2] 技能講師の手配　　技能？　……うちでいいなら教えてさしあげますよ
;	IF !BASE:淫妖 < 900 && CFLAG:属性／乞食 < 50
;		SETCOLOR 96,96,96
;		PRINTL [3] ？？？　　　　　　今の貴方にはお売りできませんね……
;		RESETCOLOR
;	ELSE
;		PRINTL [3] 淫妖なアイテム　　ちょうどいい所にいらっしゃいましたね
;	ENDIF
	PRINTL [9] 戻る　　　　　　　用がお済みでしたらお戻りください

	$INPUT_LOOP_1_1
	INPUT
	
	IF RESULT == 0
		;娼婦用服の販売へ
		CALL PRINT_SHOP_ITEM, 2
		GOTO TOP_2
	ELSEIF RESULT == 1
		;娼婦用装飾品の販売へ
		CALL PRINT_SHOP_ITEM, 6
		GOTO TOP_2
	ELSEIF RESULT == 2
		;娼婦用技能の販売へ
		CALL PRINT_SHOP_ITEM, 7
		GOTO TOP_2
	ELSEIF RESULT == 3
		IF !BASE:淫妖 < 900 && CFLAG:属性／乞食 < 50
			PRINTFORML 条件を満たしていません
		ENDIF
		;娼婦用消耗品の販売へ
		CALL PRINT_SHOP_ITEM, 12
		GOTO TOP_2
	ELSEIF RESULT == 9
		GOTO TOP
	ELSE
		PRINTL 不正な入力です
		GOTO INPUT_LOOP_1_1
	ENDIF
ELSEIF RESULT == 0
	$TOP_1
	DRAWLINE
	PRINTL 店主「いらっしゃいませ
	IF !FLAG:店主との親密度
		PRINTL 　　　お話は聞いております。
		PRINTL 　　　お気に召す物があればなんなりとお申し付けください」
	;誘拐中
	ELSEIF CFLAG:モード == 2
		PRINTL 　　　姫様を攫うとは……おのれ匪賊め、何たる事を……
		PRINTL 　　　私の目に入れたら実験台にしてやりたいですね」
	;主人への友好度が500以上
	ELSEIF CFLAG:主人への友好度 >= 500 && FLAG:指輪告知メッセージ != 2
		PRINTL 　　　お二人共仲睦まじいですね
		PRINTL 　　　……ところで、とても珍しい指輪を仕入れたのですが、いかがですか？」
		FLAG:指輪告知メッセージ = 2
	;メイド属性と姫様属性が50％ずつある
	ELSEIF CFLAG:属性／メイド == 50 && CFLAG:属性／メイド == CFLAG:属性／姫様
		PRINTL 　　　ほう……この姫様の気質は……
		PRINTL 　　　この衣装も着こなせるかも知れませんね
	ELSEIF TALENT:姉妹の許可
		PRINTL 　　　豊姫様からお話は伺っております
		PRINTL 　　　ささ、この衣服をお試しになってください
	ELSEIF !ITEM:0 && CFLAG:服装 == -1
		PRINTL 　　　おやおやまあ、姫様がこんな貧しい服装を……
		PRINTL 　　　私は王宮御用達の商人なのです。言いたいことはお分かりいただけますよね？」
	ENDIF
	IF !FLAG:淡水色の聖水購入済み
		PRINTL 　　　ところで、とても貴重な淡水色の聖水を仕入れたんです。見ていきませんか？
		PRINTL 　　　「[3]贈り物＆消費物」にて販売しております
	ENDIF
	PRINTL 
	PRINTL [0] 衣装　　　　　　　衣装でございます。替えの分も用意いたします。
	PRINTL [1] 装飾品　　　　　　きっと姫様に喜んでいただけるでしょう。
	PRINTL [2] 技能講師の手配　　技能を教える講師を手配いたします。
	PRINTL [3] 贈り物＆消費物　　姫様がお喜びになられるものを販売いたします
	PRINTL [9] 戻る　　　　　　　用がお済みでしたらお戻りください。

	$INPUT_LOOP
	INPUT
	IF RESULT == 1
		;装飾品の販売へ
		CALL PRINT_SHOP_ITEM, 4
		GOTO TOP_1
	ELSEIF RESULT == 2
		;技能の販売へ
		CALL PRINT_SHOP_ITEM, 5
		GOTO TOP_1
	ELSEIF RESULT == 3
		;消耗品の販売へ
		CALL PRINT_SHOP_ITEM, 8
		GOTO TOP_1
	ELSEIF RESULT == 9
		IF FLAG:店主との親密度 == 0
			FLAG:店主との親密度 = 1
		ENDIF
		GOTO TOP
	ELSEIF RESULT == 0
		;服の販売へ
		CALL PRINT_SHOP_ITEM, 1
		GOTO TOP_1
	ELSEIF RESULT < 0 || RESULT > 6
		GOTO INPUT_LOOP
	ENDIF
ELSEIF RESULT == 1 && !FLAG:王宮追放
	DRAWLINE
	PRINTFORML ～～闇市～～
	PRINTFORML 店主「お前誰だよ
	PRINTFORML 　　　とにかく問題だけは起こしてくれるなよ」

	CALL PRINT_SHOP_ITEM, 3
	GOTO TOP
ELSEIF RESULT == 2
	DRAWLINE
	PRINTFORML ～～旧市街の裏店～～
	PRINTFORML 店主「いらっしゃい
	IF !FLAG:裏店主との親密度
		PRINTFORML 　　　あら！　%CALLNAME:MASTER%じゃない！　お久しぶり！
		PRINTL 　　　あんな王宮では窮屈すぎて嫌になるんじゃない？
		PRINTL 　　　まあ、ここでくつろいでいきなさい」
	;誘拐中
	ELSEIF CFLAG:モード == 2
		PRINTFORML 　　　聞いてるわよ%CALLNAME:MASTER%、なんだって姫様が攫われたんだってね
		PRINTL 　　　何されるか分かったものじゃないから、早く救出してあげなさいよ？」
	ELSEIF !ITEM:0 && CFLAG:服装 <= -1
		PRINTL 　　　へえ……姫様っていつも分厚い服を着てるからこれはこれで……
		PRINTL 　　　いえ、なんでもないわ」
	ELSE
		PRINTL 　　　また来てくれたのね。
		PRINTL 　　　姫様向けに作られた服は上質な布でできているからすぐに買い手が付くのよ」
	ENDIF
	PRINTL 
	
	$INPUT_BACK_1
	
	PRINTL 売却するアイテムを選択してください
	DRAWLINE
	CALL SETCOLOR_ABL
	PRINTFORML ＜衣服類＞
	RESETCOLOR
	
	FOR L_LOCAL, 0, 104
		IF L_LOCAL == 0 && !ITEM:0
			
			IF LOCAL == CFLAG:服装
				SETCOLOR 0xFFC070
				PRINTL 　着用中
				RESETCOLOR
			ELSE
				PRINTL 
			ENDIF
		ELSEIF ITEM:L_LOCAL
			BOUGHT = L_LOCAL
			CALL ITEM_MONEY
			ITEM_COST = RESULT
			IF RESULT
				PRINTFORM [{L_LOCAL, 2}] - %ITEMNAME:(L_LOCAL), 24, LEFT%　${ITEM_COST/2}
				IF L_LOCAL == CFLAG:服装
					SETCOLOR 0xFFC070
					PRINTL 　着用中
					RESETCOLOR
				ELSE
					PRINTL 
				ENDIF
			ENDIF
		ENDIF
		
		;PRINTFORML {L_LOCAL}
		IF L_LOCAL != CLOTHE_LIST(L_LOCAL)
			L_LOCAL = CLOTHE_LIST(L_LOCAL) - 1
		ELSE
			L_LOCAL = CLOTHE_LIST(L_LOCAL)
		ENDIF
		;PRINTFORML 次:{L_LOCAL}
	NEXT
	DRAWLINE
	CALL SETCOLOR_ABL
	PRINTFORML ＜その他アイテム＞
	RESETCOLOR
	FOR L_LOCAL, 522, 527
		IF L_LOCAL == 0 && !ITEM:0
			
			IF LOCAL == CFLAG:服装
				SETCOLOR 0xFFC070
				PRINTL 　着用中
				RESETCOLOR
			ELSE
				PRINTL 
			ENDIF
		ELSEIF ITEM:L_LOCAL
			BOUGHT = L_LOCAL
			CALL ITEM_MONEY
			ITEM_COST = RESULT
			PRINTFORM [{L_LOCAL, 2}] - %ITEMNAME:(L_LOCAL), 16, LEFT%　${ITEM_COST/2}
			IF L_LOCAL == CFLAG:服装
				SETCOLOR 0xFFC070
				PRINTL 　着用中
				RESETCOLOR
			ELSE
				PRINTL 
			ENDIF
		ENDIF
	NEXT
	
	PRINTL [999] 戻る
	
	$INPUT_LOOP_2
	INPUT
	
	IF ITEM:RESULT && RESULT <= 104 || (RESULT >= 522 && RESULT <= 526)
		IF RESULT == CFLAG:服装 && CFLAG:服装 != 0
			PRINTFORML 今着ている衣装を引き取ることはできないわね……
			GOTO INPUT_LOOP_2
		ENDIF
		IF RESULT == 0
			;誘拐中は今着ている衣装を売れない
			IF CFLAG:モード == 2 && CFLAG:服装 == 0
				PRINTFORML さすがに誘拐されている姫様の衣装を剥くのは無理よ
				GOTO INPUT_LOOP_2
			ENDIF
			PRINTFORML それを売るって……
			IF CFLAG:モード == 2
				PRINTFORML よほど切羽詰まってるのね……王宮も無償で捜索隊を出してあげればいいのに
			ELSEIF CFLAG:服装 == 0
				PRINTFORML 今着ている衣装じゃない、その場で裸にする気？
			ELSE
				PRINTFORML それを売るとさすがにあなたの立場が危ないんじゃない？
			ENDIF
			PRINTL [0] - それでも売る
			PRINTL [1] - やっぱりやめる
			
			$INPUT_LOOP_4
			INPUT
			
			IF RESULT == 0
				PRINTFORML 何があっても責任は取れないからね……
				BOUGHT = 0
				DRAWLINE
				GOTO TOKUSYU_RABEL
			ELSEIF RESULT == 1
				GOTO INPUT_BACK_1
			ELSE
				PRINTFORML ごまかさないで、これはあなたの将来がかかってる大事な話なの
				GOTO INPUT_LOOP_4
			ENDIF
		ELSE
			BOUGHT = RESULT
			$TOKUSYU_RABEL
			CALL ITEM_MONEY
			;半壊or全壊の場合、買い取り額が1/4に
			IF BOUGHT <= 104
				IF DITEMTYPE:(BOUGHT):14 == 2
					ITEM_COST = RESULT / 8
				ELSEIF DITEMTYPE:(BOUGHT):14 == 1
					ITEM_COST = RESULT / 4
				ELSE
					ITEM_COST = RESULT / 2
				ENDIF
			ELSE
				ITEM_COST = RESULT / 2
			ENDIF
			IF BOUGHT <= 104
				PRINTFORML その衣装は${ITEM_COST}で引き取るわ
			ELSE
				PRINTL いくつ売りますか？
				PRINTFORML (現在の持ち数:{ITEM:BOUGHT})
				PRINTL [1] - 1個
				PRINTL [2] - 2個
				IF ITEM:BOUGHT >= 5
					PRINTL [5] - 5個
				ENDIF
				PRINTFORML [{ITEM:BOUGHT}] - 全部
				
				$INPUT_LOOP_B
				INPUT
				
				IF RESULT <= ITEM:BOUGHT
					LOCAL:1 = RESULT
				ELSE
					PRINTL 入力が不正です
					GOTO INPUT_LOOP_B
				ENDIF
				PRINTFORML {LOCAL:1}個ね。全部で${ITEM_COST*LOCAL:1}で引き取るわ
			ENDIF
			PRINTL [0] - 売る
			PRINTL [1] - やめる
			$INPUT_LOOP_3
			
			INPUT
			
			IF RESULT == 0 && BOUGHT <= 104
				ITEM:BOUGHT = 0
				MONEY += ITEM_COST
				CALL RESET_REMODEL, BOUGHT
				CALLFORM RESET_REMODEL, BOUGHT
				IF BOUGHT == 0 && CFLAG:服装 == 0
					PRINTFORMW %CALLNAME:TARGET%は怪しげに%CALLNAME:MASTER%を見つめながら店主や店員に服を脱がされていった
					PRINTFORML 「さすがに一糸纏わぬ姿では出せないわよね……」
					PRINTFORMW 店主は%CALLNAME:TARGET%の身体に布切れを巻いた
					PRINTFORML 「よし！　これで大丈夫！　これが代金ね」
					PRINTFORMW %CALLNAME:MASTER%は普段着の引き取りの代金を受け取った
					CALL DATA_CHANGE_CLOTHE, -1, "変更"
				ELSE
					PRINTFORML ありがとう！　これは引き取りの代金ね！
				ENDIF
				DRAWLINE
				GOTO INPUT_BACK_1
			;衣服以外のアイテム
			ELSEIF RESULT == 0
				
				ITEM:BOUGHT -= LOCAL:1
				MONEY += ITEM_COST*LOCAL:1
				
				PRINTFORML ありがとう！　これは引き取りの代金ね！
				
				DRAWLINE
				GOTO INPUT_BACK_1
			ELSEIF RESULT == 1
				GOTO INPUT_BACK_1
			ELSE
				PRINTFORML あなた、それ持ってないじゃない
				GOTO INPUT_LOOP_3
			ENDIF
		ENDIF
	ELSEIF RESULT == 999
		IF FLAG:裏店主との親密度 == 0
			FLAG:裏店主との親密度 = 1
		ENDIF
		GOTO TOP
	ELSE
		GOTO INPUT_LOOP_2
	ENDIF
ELSEIF RESULT == 3
	CALL SOUL_SHOP
	GOTO TOP
;修復屋
ELSEIF RESULT == 4
	DRAWLINE
	CALL SHOP_CLOTHE_REPAIR
	GOTO TOP
ELSEIF RESULT == 9
	RETURN 1
ELSE
	PRINTFORML 入力が不正です
	GOTO INPUT_LOOP_1
ENDIF

;アイテムの値段を変数Aに格納して返す関数
@ITEM_MONEY
IF BOUGHT == 0
	A = 100000
ELSEIF BOUGHT == 1
	A = 15000
ELSEIF BOUGHT == 2
	A = 20000
ELSEIF BOUGHT == 3
	A = 40000
ELSEIF BOUGHT == 4
	A = 50000
ELSEIF BOUGHT == 5
	A = 50000
ELSEIF BOUGHT == 6
	A = 80000
ELSEIF BOUGHT == 8
	A = 250000
ELSEIF BOUGHT == 10
	A = 10000
ELSEIF BOUGHT == 11
	A = 10000
ELSEIF BOUGHT == 12
	A = 10000
ELSEIF BOUGHT == 13
	A = 20000
ELSEIF BOUGHT == 14
	A = 25000
ELSEIF BOUGHT == 15
	A = 10000
ELSEIF BOUGHT == 16
	A = 10000
ELSEIF BOUGHT == 20
	A = 100000
ELSEIF BOUGHT == 21
	A = 100000
ELSEIF BOUGHT == 22
	A = 100000
ELSEIF BOUGHT == 23
	A = 200000
ELSEIF BOUGHT == 24
	A = 50000
ELSEIF BOUGHT == 25
	A = 100000
ELSEIF BOUGHT == 26
	A = 100000
ELSEIF BOUGHT == 30
	A = 150000
ELSEIF BOUGHT == 31
	A = 150000
ELSEIF BOUGHT == 32
	A = 150000
ELSEIF BOUGHT == 33
	A = 250000
ELSEIF BOUGHT == 34
	A = 75000
ELSEIF BOUGHT == 35
	A = 150000
ELSEIF BOUGHT == 36
	A = 150000
ELSEIF BOUGHT == 50
	A = 60000
ELSEIF BOUGHT == 51
	A = 80000
ELSEIF BOUGHT == 52
	A = 0
ELSEIF BOUGHT == 53
	A = 90000
ELSEIF BOUGHT == 54
	A = 90000
ELSEIF BOUGHT == 56
	A = 100000
ELSEIF BOUGHT == 57
	A = 150000
ELSEIF BOUGHT == 58
	A = 150000
ELSEIF BOUGHT == 59
	A = 250000
ELSEIF BOUGHT == 60
	A = 200000
ELSEIF BOUGHT == 61
	A = 0
ELSEIF BOUGHT == 65
	A = 45000
ELSEIF BOUGHT == 66
	A = 45000
ELSEIF BOUGHT == 66
	A = 0
ELSEIF BOUGHT == 68
	A = 270000
ELSEIF BOUGHT == 69
	A = 80000
ELSEIF BOUGHT == 70
	A = 80000
ELSEIF BOUGHT == 71
	A = 150000
ELSEIF BOUGHT == 100
	A = 120000
ELSEIF BOUGHT == 101
	A = 120000
ELSEIF BOUGHT == 102
	A = 120000
ELSEIF BOUGHT == 103
	A = 120000
ELSEIF BOUGHT == 350
	A = 40000
ELSEIF BOUGHT == 351
	A = 70000
ELSEIF BOUGHT == 352
	A = 80000
ELSEIF BOUGHT == 380
	A = 80000
ELSEIF BOUGHT == 400
	A = 30000
ELSEIF BOUGHT == 401
	A = 80000
ELSEIF BOUGHT >= 402 && BOUGHT <= 407
	A = 110000
ELSEIF BOUGHT == 410
	A = 30000
ELSEIF BOUGHT == 411
	A = 80000
ELSEIF BOUGHT >= 412 && BOUGHT <= 417
	A = 110000
ELSEIF BOUGHT == 420
	A = 30000
ELSEIF BOUGHT == 421
	A = 80000
ELSEIF BOUGHT >= 422 && BOUGHT <= 427
	A = 110000
ELSEIF BOUGHT == 428
	A = 50000
ELSEIF BOUGHT == 490 
	A = 50000
ELSEIF BOUGHT == 491 
	A = 50000
ELSEIF BOUGHT == 492 
	A = 50000
ELSEIF BOUGHT == 493 
	A = 50000
ELSEIF BOUGHT == 494 
	A = 50000
ELSEIF BOUGHT == 495
	A = 50000
ELSEIF BOUGHT == 496 
	A = 80000
ELSEIF BOUGHT == 497 
	A = 80000
ELSEIF BOUGHT == 500
	A = 40000
ELSEIF BOUGHT == 501
	A = 50000
ELSEIF BOUGHT == 503
	A = 5000
ELSEIF BOUGHT == 504
	A = 20000
ELSEIF BOUGHT == 505
	A = 25000
ELSEIF BOUGHT == 506
	A = 40000
ELSEIF BOUGHT == 507
	A = 70000
;能力上昇アイテムは一括管理
ELSEIF BOUGHT >= 522 && BOUGHT <= 526
	A = 8000
ELSEIF BOUGHT == 527
	A = 60000
ELSEIF BOUGHT == 529
	A = 2000
ELSEIF BOUGHT == 533
	A = 24000
ELSEIF BOUGHT == 534
	A = 48000
ELSEIF BOUGHT == 535
	A = 95000
ELSEIF BOUGHT == 536
	A = 15000
ELSEIF BOUGHT == 537
	A = 50000
ELSEIF BOUGHT == 538
	A = 45000
ELSEIF BOUGHT == 539
	A = 90000
ELSEIF BOUGHT == 545
	A = 45000
ELSEIF BOUGHT == 560
	A = 15000
ELSEIF BOUGHT == 561
	A = 30000
ELSEIF BOUGHT == 562
	A = 80000
ELSEIF BOUGHT == 563
	A = 100000
ELSEIF BOUGHT == 564
	A = 140000
ELSEIF BOUGHT == 575
	A = 10000
ELSEIF BOUGHT == 576
	A = 25000
ELSEIF BOUGHT == 577
	A = 70000
ELSEIF BOUGHT == 578
	A = 90000
ELSEIF BOUGHT == 579
	A = 120000
ELSEIF BOUGHT == 601
	A = 8000
ELSEIF BOUGHT == 602
	A = 15000
ELSEIF BOUGHT == 710
	A = 800000
ELSEIF INRANGE(BOUGHT, 810, 817)
	A = 60000
ELSEIF BOUGHT == 822
	A = 25000
ELSEIF BOUGHT == 824
	A = 60000
ENDIF

RETURN A

;アイテム出現条件
@SALEITEM_CHECK
;初期化
REPEAT 100
	ITEMSALES:COUNT = 0
REND


;基本アイテム
REPEAT 5
	LOCAL = 1 + COUNT
	IF ITEM:LOCAL
		ITEMSALES:LOCAL = 0
	ELSE
		ITEMSALES:LOCAL = 1
	ENDIF
REND

;コスプレ系統は服を売却していると出る
REPEAT 7
	LOCAL = 10 + COUNT
	IF !ITEM:0
		IF ITEM:LOCAL
			ITEMSALES:LOCAL = 0
		ELSE
			ITEMSALES:LOCAL = 1
		ENDIF
	;それ以外は各条件を満たすと出現
	ELSE
		;10:　メイド服　美麗が70以上
		IF LOCAL == 10 && BASE:美麗 >= 70
			IF ITEM:LOCAL
				ITEMSALES:LOCAL = 0
			ELSE
				ITEMSALES:LOCAL = 1
			ENDIF
		ENDIF
		
		;11:　修道服　アライメントが30以上
		IF LOCAL == 11 && BASE:アライメント >= 130
			IF ITEM:LOCAL
				ITEMSALES:LOCAL = 0
			ELSE
				ITEMSALES:LOCAL = 1
			ENDIF
		ENDIF
		
		;12:　ゴスロリ　知力が70以上
		IF LOCAL == 12 && BASE:知力 >= 70
			IF ITEM:LOCAL
				ITEMSALES:LOCAL = 0
			ELSE
				ITEMSALES:LOCAL = 1
			ENDIF
		ENDIF
		
		;13:　ドレス　美麗が70以上
		IF LOCAL == 13 && BASE:美麗 >= 70
			IF ITEM:LOCAL
				ITEMSALES:LOCAL = 0
			ELSE
				ITEMSALES:LOCAL = 1
			ENDIF
		ENDIF
		
		;14:　呪詛の布切れ　アライメントが-30以下
		IF LOCAL == 14 && BASE:アライメント <= 70
			IF ITEM:LOCAL
				ITEMSALES:LOCAL = 0
			ELSE
				ITEMSALES:LOCAL = 1
			ENDIF
		ENDIF
	ENDIF
REND

;各種属性が15％以上で解禁
REPEAT 7
	IF COUNT == 4
		COUNT += 1
	ENDIF
	LOCAL = 20 + COUNT
	;20:　メイド属性が15％以上
	IF LOCAL == 20 && CFLAG:属性／メイド >= 15
		IF ITEM:LOCAL
			ITEMSALES:LOCAL = 0
		ELSE
			ITEMSALES:LOCAL = 1
		ENDIF
	ENDIF
	
	;21:　シスター属性が15％以上
	IF LOCAL == 21 && CFLAG:属性／シスター >= 15
		IF ITEM:LOCAL
			ITEMSALES:LOCAL = 0
		ELSE
			ITEMSALES:LOCAL = 1
		ENDIF
	ENDIF
	
	;22:　ゴスロリ属性が15％以上
	IF LOCAL == 22 && CFLAG:属性／ゴスロリ >= 15
		IF ITEM:LOCAL
			ITEMSALES:LOCAL = 0
		ELSE
			ITEMSALES:LOCAL = 1
		ENDIF
	ENDIF
	
	;23:　花嫁属性が15％以上
	IF LOCAL == 23 && CFLAG:属性／花嫁 >= 15
		IF ITEM:LOCAL
			ITEMSALES:LOCAL = 0
		ELSE
			ITEMSALES:LOCAL = 1
		ENDIF
	ENDIF
	
	;25or26:　武士属性が15％以上
	IF (LOCAL == 25 || LOCAL == 26) && CFLAG:属性／武士 >= 15
		IF ITEM:LOCAL
			ITEMSALES:LOCAL = 0
		ELSE
			ITEMSALES:LOCAL = 1
		ENDIF
	ENDIF
REND

;各種属性が35％以上で解禁
REPEAT 7
	LOCAL = 30 + COUNT
	;30:　メイド属性が35％以上
	IF LOCAL == 30 && CFLAG:属性／メイド >= 35
		IF ITEM:LOCAL
			ITEMSALES:LOCAL = 0
		ELSE
			ITEMSALES:LOCAL = 1
		ENDIF
	ENDIF
	
	;31:　シスター属性が35％以上
	IF LOCAL == 31 && CFLAG:属性／シスター >= 35
		IF ITEM:LOCAL
			ITEMSALES:LOCAL = 0
		ELSE
			ITEMSALES:LOCAL = 1
		ENDIF
	ENDIF
	
	;32:　ゴスロリ属性が35％以上
	IF LOCAL == 32 && CFLAG:属性／ゴスロリ >= 35
		IF ITEM:LOCAL
			ITEMSALES:LOCAL = 0
		ELSE
			ITEMSALES:LOCAL = 1
		ENDIF
	ENDIF
	
	;33:　花嫁属性が35％以上
	IF LOCAL == 33 && CFLAG:属性／花嫁 >= 35
		IF ITEM:LOCAL
			ITEMSALES:LOCAL = 0
		ELSE
			ITEMSALES:LOCAL = 1
		ENDIF
	ENDIF
	
	;35or36:　武士属性が35％以上
	IF (LOCAL == 35 || LOCAL == 36) && CFLAG:属性／武士 >= 35
		IF ITEM:LOCAL
			ITEMSALES:LOCAL = 0
		ELSE
			ITEMSALES:LOCAL = 1
		ENDIF
	ENDIF
REND

;姉妹の許可があると出現
IF TALENT:姉妹の許可
	ITEMSALES:65 = 1
ENDIF


;ビデオカメラが無いときはビデオテープを、カメラが無いときはビデオの販売をしない
SIF ITEM:18 == 0
	ITEMSALES:43 = 0
SIF ITEM:19 == 0
	ITEMSALES:44 = 0

;汚れ無視
IF TALENT:MASTER:64
	ITEMSALES:60 = 0
ELSE
	ITEMSALES:60 = 1
ENDIF

;調合知識
;主人禁断の知識を持っていて、技巧が4以上かつ陥落済みの助手が調合知識を持っている場合、調合知識が買えるようになる
ITEMSALES:61 = 0
IF TALENT:MASTER:144 && TALENT:MASTER:55 == 0 && ABL:MASTER:2 >= 4 && ASSI >= 1
	SIF TALENT:ASSI:55 && (TALENT:ASSI:3 || TALENT:ASSI:4 || TALENT:ASSI:5 || TALENT:ASSI:6 || TALENT:ASSI:7 || TALENT:ASSI:8)
		ITEMSALES:61 = 1
ENDIF

;禁断の知識
SIF TALENT:MASTER:144 == 0
	ITEMSALES:62 = 1

;主人か助手が『調合知識』を持っている
P = 0
REPEAT CHARANUM
	IF COUNT == MASTER && TALENT:COUNT:55
		P = 1
	ELSEIF CFLAG:COUNT:1 >= 1 && ISASSI:COUNT == 1
		SIF TALENT:COUNT:55
			P = 1
	ENDIF
REND

;主人か助手が『禁断の知識』を持っている
F = 0
REPEAT CHARANUM
	IF COUNT == MASTER && TALENT:COUNT:144
		F = 1
		ITEMSALES:62 = 0
	ELSEIF CFLAG:COUNT:1 >= 1 && ISASSI:COUNT == 1
		SIF TALENT:COUNT:144
			F = 1
	ENDIF
REND

;触手使役術
ITEMSALES:25 = 0
SIF F == 1 && ITEM:25 == 0
	ITEMSALES:25 = 1

;第三の瞳
ITEMSALES:63 = 0
SIF F == 1 && TALENT:MASTER:156 == 0
	ITEMSALES:63 = 1

;元気になる薬（条件は調合知識のみ）
ITEMSALES:70 = 0
IF P
	REPEAT CHARANUM
		SIF BASE:COUNT:0 != MAXBASE:COUNT:0 && CFLAG:COUNT:12 == 0
			ITEMSALES:70 = 1
	REND
ENDIF

;記憶消去薬
ITEMSALES:90 = 0
IF F && P
	REPEAT CHARANUM
		SIF COUNT == MASTER
			CONTINUE
		SIF CFLAG:COUNT:12 == 0
			ITEMSALES:90 = 1
	REND
ENDIF

;排卵誘発剤
ITEMSALES:91 = 0
REPEAT CHARANUM
	SIF CFLAG:COUNT:12 == 0 && CFLAG:COUNT:109 == 0 && TALENT:COUNT:140 == 0
		ITEMSALES:91 = 1
REND

;子宮内避妊結界
ITEMSALES:92 = 0
REPEAT CHARANUM
	SIF CFLAG:COUNT:12 == 0 && CFLAG:COUNT:108 == 0 && TALENT:COUNT:140 == 0
		ITEMSALES:92 = 1
REND

@EVENTBUY
;アイテムメニュー以外での購入のキャンセル
IF BOUGHT >= 0 && BOUGHT <= 99
	ITEM:BOUGHT -= 1
	CALL ITEM_MONEY
	MONEY += A
ENDIF

;アイテム購入
@BUY_ITEM
;表示されたアイテムが無い場合
A = 0
REPEAT 100
	SIF ITEMSALES:COUNT == 1
		A += 1
REND
IF A == 0
	PRINTW 購入できるアイテムはありません
	RETURN 0
ENDIF

PRINTL [100] 戻る
PRINTL 
PRINTL 購入したいアイテムの番号を選択してください
$INPUT_LOOP
INPUT
IF RESULT == 100
	RETURN 0
ELSEIF RESULT < 0 || RESULT > 100 || ITEMSALES:RESULT == 0
	GOTO INPUT_LOOP
ENDIF

BOUGHT = RESULT
CALL ITEM_MONEY
IF MONEY < A
	PRINTL お金が足りません
	RETURN 0
ENDIF


;購入の意志を再確認するように
$INPUT_LOOP_2
IF BOUGHT <= 26 && BOUGHT != 25
	PRINTFORML 本当に%ITEMNAME:BOUGHT%を購入しますか？
	PRINTL [0] 購入する
	PRINTL [1] やめる
	INPUT
	IF RESULT == 1
		RETURN 0
	ELSEIF RESULT < 0 || RESULT > 1
		GOTO INPUT_LOOP_2
	ENDIF
	PRINTFORMW ＜%ITEMNAME:BOUGHT%を購入しました＞
ELSEIF (BOUGHT >= 60 && BOUGHT <= 69) || BOUGHT == 25
	PRINTFORML 本当に%ITEMNAME:BOUGHT%を身につけますか？
	PRINTL [0] 身につける
	PRINTL [1] やめる
	INPUT
	IF RESULT == 1
		RETURN 0
	ELSEIF RESULT < 0 || RESULT > 1
		GOTO INPUT_LOOP_2
	ENDIF
	PRINTFORMW ＜%ITEMNAME:BOUGHT%を身につけました＞
ENDIF
;調教アイテムは買ったらショップから消える
IF BOUGHT <= 26
	CALL ITEM_MONEY
	MONEY -= A
	ITEMSALES:BOUGHT = 0
	ITEM:BOUGHT = 1
;素質アイテムは買ったらショップ、手持ちから消える
ELSEIF BOUGHT >= 60 && BOUGHT <= 69
	CALL ITEM_MONEY
	MONEY -= A
	ITEMSALES:BOUGHT = 0
	ITEM:BOUGHT = 0
	;素質アイテム【汚れ無視】
	SIF BOUGHT == 60
		TALENT:MASTER:64 = 1
	;素質アイテム【調合知識】
	SIF BOUGHT == 61
		TALENT:MASTER:55 = 1
	;素質アイテム【禁断の知識】
	SIF BOUGHT == 62
		TALENT:MASTER:144 = 1
	;素質アイテム【覚】
	SIF BOUGHT == 63
		TALENT:MASTER:156 = 1
ENDIF

;複数所持可能なアイテムの場合
SIF BOUGHT >= 40 && BOUGHT <= 59
	CALL BUY_PLURAL
;主に奴隷を対象とするアイテムの場合
SIF (BOUGHT >= 70 && BOUGHT <= 89) || (BOUGHT >= 90 && BOUGHT <= 99)
	CALL USE_ITEM


;複数個所持可能なアイテムについて、同時購入個数を選択
@BUY_PLURAL
;現在の購入可能数、Bは所持可能最大数（現在100個）、Cは所持金によるもの
;Aはアイテムの単価、DはBとCのうち小さい方、EはB<=Cであれば0、B>Cであれば1
CALL ITEM_MONEY
B = 99-ITEM:BOUGHT
C = MONEY/A
IF B <= C
	D = B
	E = 0
ELSE
	D = C
	E = 1
ENDIF
DRAWLINE
PRINTFORM %ITEMNAME:BOUGHT%をいくつ買いますか？ （1-
PRINTV D
PRINTL 、0で戻る）

$INPUT_LOOP
INPUT
IF RESULT == 0
	RETURN 0
ELSEIF RESULT < 0
	GOTO INPUT_LOOP
ELSEIF RESULT > D
	IF RESULT > D && E == 0
		PRINTL そんなに持てません
	ELSEIF RESULT > D && E == 1
		PRINTL お金が足りません
	ENDIF
	GOTO INPUT_LOOP
ELSEIF RESULT == 1
	PRINTFORMW ＜%ITEMNAME:BOUGHT%を購入しました＞
	ITEM:BOUGHT += RESULT
	MONEY -= A*RESULT
	RETURN 0
ELSE
	PRINTFORMW ＜%ITEMNAME:BOUGHT%を{RESULT}個購入しました＞
	ITEM:BOUGHT += RESULT
	MONEY -= A*RESULT
	RETURN 0
ENDIF

;アイテム使用
@USE_ITEM
DRAWLINE
;アイテムの効果を表示する
SIF BOUGHT == 70
	PRINTFORML %ITEMNAME:BOUGHT%:体力を回復します
SIF BOUGHT == 71
	PRINTFORML %ITEMNAME:BOUGHT%:ふたなりになります
SIF BOUGHT == 72
	PRINTFORML %ITEMNAME:BOUGHT%:ふたなりを消去します
SIF BOUGHT == 73
	PRINTFORML %ITEMNAME:BOUGHT%:母乳体質になります
SIF BOUGHT == 74
	PRINTFORML %ITEMNAME:BOUGHT%:処女膜が再生します
SIF BOUGHT == 75
	PRINTFORML %ITEMNAME:BOUGHT%:胸を大きくします
SIF BOUGHT == 76
	PRINTFORML %ITEMNAME:BOUGHT%:胸を小さくします
SIF BOUGHT == 77
	PRINTFORML %ITEMNAME:BOUGHT%:母乳が出なくなります
SIF BOUGHT == 78
	PRINTFORML %ITEMNAME:BOUGHT%:お漏らし癖が治ります
SIF BOUGHT == 79
	PRINTFORML %ITEMNAME:BOUGHT%:強制的に卵を産ませます
SIF BOUGHT == 90
	PRINTFORML %ITEMNAME:BOUGHT%:調教の記憶を消去します
SIF BOUGHT == 91
	PRINTFORML %ITEMNAME:BOUGHT%:一日だけ妊娠確率を上昇させます
SIF BOUGHT == 92
	PRINTFORML %ITEMNAME:BOUGHT%:一日だけ膣射経験の増加を防ぎます

CALL ITEM_MONEY
IF MONEY < A
	PRINTL お金が足りません
	RETURN 0
ENDIF

PRINTL 誰に使いますか？

REPEAT CHARANUM
	TFLAG:COUNT = 0
	;主人公は排除、ただしふたなり、処女再生、胸関連、妊娠関連は可能
	SIF COUNT == MASTER && BOUGHT != 71 && BOUGHT != 72 && BOUGHT != 74 && BOUGHT != 75 && BOUGHT != 91 && BOUGHT != 92
		CONTINUE
	;労役中のキャラも排除
	SIF CFLAG:COUNT:12 > 0
		CONTINUE
	SIF BOUGHT == 70 && BASE:COUNT:0 == MAXBASE:COUNT:0
		CONTINUE
	SIF BOUGHT == 71 && (TALENT:COUNT:139 || TALENT:COUNT:137 || TALENT:COUNT:140)
		CONTINUE
	SIF BOUGHT == 71 && F == 0 && TALENT:COUNT:55 == 0 && TALENT:COUNT:138 == 0 && TALENT:COUNT:146 == 0
		CONTINUE
	SIF BOUGHT == 72 && (TALENT:COUNT:139 == 0 || TALENT:COUNT:137 || TALENT:COUNT:140)
		CONTINUE
	SIF BOUGHT == 73 && (TALENT:COUNT:149 || TALENT:COUNT:140)
		CONTINUE
	IF BOUGHT == 74 && (TALENT:COUNT:0 || TALENT:COUNT:1 || TALENT:COUNT:140)
		SIF NO:COUNT != 14 || CFLAG:COUNT:0
			CONTINUE
	ENDIF
	SIF BOUGHT == 75 && (TALENT:COUNT:112 || TALENT:COUNT:140)
		CONTINUE
	SIF BOUGHT == 76 && (TALENT:COUNT:110 || TALENT:COUNT:140)
		CONTINUE
	SIF BOUGHT == 77 && (TALENT:COUNT:149 == 0 || TALENT:COUNT:140)
		CONTINUE
	SIF BOUGHT == 78 && TALENT:COUNT:57 == 0
		CONTINUE
	SIF BOUGHT == 79 && (TALENT:COUNT:140 || TALENT:COUNT:153 == 0 || (TALENT:COUNT:153 && CFLAG:COUNT:110 - 3 <= DAY) || BASE:COUNT:0 < 1000)
		CONTINUE
	SIF BOUGHT == 91 && (CFLAG:COUNT:109 || TALENT:COUNT:140)
		CONTINUE
	SIF BOUGHT == 92 && (CFLAG:COUNT:108 || TALENT:COUNT:140)
		CONTINUE
	PRINT 体力
	A = BASE:COUNT:0
	SIF BASE:COUNT:0 < 0
		A = 0
	BAR A,MAXBASE:COUNT:0,16
	PRINTFORM ({A}/{MAXBASE:COUNT:0})
	PRINTFORM  [{COUNT}]%NAME:COUNT% 
	SIF CFLAG:COUNT:1 == 2
		PRINT 助手可
	PRINTL 
	TFLAG:COUNT = 1
REND
PRINTL [100] 戻る

$INPUT_LOOP
INPUT
IF RESULT == 100
	ITEM:BOUGHT = 0
	RETURN 0
ELSE
	IF RESULT < 0 || RESULT >= CHARANUM
		GOTO INPUT_LOOP
	ELSEIF TFLAG:RESULT == 0
		GOTO INPUT_LOOP
	ENDIF
ENDIF

B = RESULT
CALL ITEM_MONEY
MONEY -= A
RESULT = B

;体力回復
IF BOUGHT == 70
	PRINTFORMW ＜%NAME:RESULT%の体力が回復した＞
	BASE:RESULT:0 += 300
	SIF BASE:RESULT:0 > MAXBASE:RESULT:0
		BASE:RESULT:0 = MAXBASE:RESULT:0
	CFLAG:RESULT:10 += 5
ENDIF
;ふたなり化
IF BOUGHT == 71
	PRINTFORMW ＜%NAME:RESULT%はふたなりになった＞
	TALENT:RESULT:138 = 0
	TALENT:RESULT:146 = 0
	TALENT:RESULT:139 = 1
	CFLAG:RESULT:10 += 2
ENDIF
;ふたなりを消去
IF BOUGHT == 72
	PRINTFORMW ＜%NAME:RESULT%はふたなりではなくなった＞
	TALENT:RESULT:139 = 0
	CFLAG:RESULT:10 += 2
ENDIF
;母乳体質
IF BOUGHT == 73
	PRINTFORMW ＜%NAME:RESULT%は母乳が出るようになった＞
	TALENT:RESULT:149 = 1
	CFLAG:RESULT:10 += 2
ENDIF
;処女膜再生
IF BOUGHT == 74
	;条件が揃っているならアリスをSP化(東方専用)
	IF NO:RESULT == 14 && (TALENT:RESULT:0 || TALENT:RESULT:1) && CFLAG:RESULT:0 == 0
		SIF TARGET >= 0
			T = NO:TARGET
		SIF ASSI >= 0
			A = NO:ASSI
		DELCHARA RESULT
		ADDSPCHARA 14
		PRINTFORMW ＜アリスは子供の姿になった＞
		TARGET = CHARANUM-1
		CALL CLOTHES_INITIALIZE
		REPEAT CHARANUM
			SIF NO:COUNT == T
				TARGET = COUNT
			SIF NO:COUNT == A
				ASSI = COUNT
		REND
		SIF A == 14
			ASSI = -1
	ELSE
		PRINTFORMW ＜%NAME:RESULT%の処女膜が再生された＞
		TALENT:RESULT:1 = 1
	ENDIF
	CFLAG:RESULT:10 += 2
ENDIF

;豊乳化
IF BOUGHT == 75
	;絶壁→貧乳
	IF TALENT:RESULT:110
		PRINTFORMW ＜%NAME:RESULT%の胸がほんの少しだけ膨らんだ＞
		TALENT:RESULT:110 = 0
		TALENT:RESULT:109 = 1
	;貧乳→普乳
	ELSEIF TALENT:RESULT:109
		PRINTFORMW ＜%NAME:RESULT%の胸が人並みに大きくなった＞
		TALENT:RESULT:109 = 0
	;普乳→巨乳
	ELSEIF TALENT:RESULT:111 == 0
		PRINTFORMW ＜%NAME:RESULT%の胸が豊満になった＞
		TALENT:RESULT:111 = 1
	;巨乳→爆乳
	ELSE
		;小柄体型、小人体型
		IF TALENT:RESULT:100 || TALENT:RESULT:142
			PRINTFORMW ＜%NAME:RESULT%の胸が体に不釣合いなまでに大きくなった＞
		;それ以外
		ELSE
			PRINTFORMW ＜%NAME:RESULT%の胸が溢れんばかりの大きさになった＞
		ENDIF
		TALENT:RESULT:111 = 0
		TALENT:RESULT:112 = 1
	ENDIF
	CFLAG:RESULT:10 += 2
ENDIF

;縮乳化
IF BOUGHT == 76
	;爆乳→巨乳
	IF TALENT:RESULT:112
		PRINTFORMW ＜%NAME:RESULT%の豊かすぎる胸が一回り小さくなった＞
		TALENT:RESULT:112 = 0
		TALENT:RESULT:111 = 1
	;巨乳→普乳
	ELSEIF TALENT:RESULT:111
		PRINTFORMW ＜%NAME:RESULT%の胸が人並みに小さくなった＞
		TALENT:RESULT:111 = 0
	;普乳→貧乳
	ELSEIF TALENT:RESULT:109 == 0
		PRINTFORMW ＜%NAME:RESULT%の胸が小さくなった＞
		TALENT:RESULT:109 = 1
	;貧乳→絶壁
	ELSE
		PRINTFORMW ＜%NAME:RESULT%の胸が極端に薄くなった＞
		TALENT:RESULT:109 = 0
		TALENT:RESULT:110 = 1
		IF TALENT:RESULT:149
			PRINTFORMW ＜%NAME:RESULT%の母乳が出なくなった＞
			TALENT:RESULT:149 = 0
			CFLAG:RESULT:10 += 1
		ENDIF
	ENDIF
	CFLAG:RESULT:10 += 2
ENDIF

;母乳治療
IF BOUGHT == 77
	PRINTFORMW ＜%NAME:RESULT%は母乳が出なくなった＞
	TALENT:RESULT:149 = 0
	CFLAG:RESULT:10 += 2
ENDIF
;お漏らし治療
IF BOUGHT == 78
	PRINTFORMW ＜%NAME:RESULT%のお漏らし癖が治った＞
	TALENT:RESULT:57 = 0
	EXP:RESULT:31 = 0
	CFLAG:RESULT:10 += 2
ENDIF
;黄色いキャンディ
IF BOUGHT == 79
	A = RESULT
	CALL LAY_EGG
ENDIF

;記憶消去
IF BOUGHT == 90
	ADDCHARA NO:RESULT
	TARGET = CHARANUM-1
	SIF TALENT:RESULT:0
		TALENT:TARGET:0 = 1
	SIF TALENT:RESULT:1
		TALENT:TARGET:1 = 1
	SIF TALENT:RESULT:139
		TALENT:TARGET:139 = 1
	SIF TALENT:RESULT:149
		TALENT:TARGET:149 = 1
	EXP:TARGET:0 = EXP:RESULT:0
	EXP:TARGET:1 = EXP:RESULT:1
	EXP:TARGET:2 = EXP:RESULT:2
	EXP:TARGET:3 = EXP:RESULT:3
	EXP:TARGET:4 = EXP:RESULT:4
	EXP:TARGET:5 = EXP:RESULT:5
	EXP:TARGET:10 = EXP:RESULT:10
	EXP:TARGET:11 = EXP:RESULT:11
	EXP:TARGET:20 = EXP:RESULT:20
	EXP:TARGET:21 = EXP:RESULT:21
	EXP:TARGET:22 = EXP:RESULT:22
	EXP:TARGET:23 = EXP:RESULT:23
	EXP:TARGET:30 = EXP:RESULT:30
	EXP:TARGET:31 = EXP:RESULT:31
	EXP:TARGET:32 = EXP:RESULT:32
	EXP:TARGET:40 = EXP:RESULT:40
	EXP:TARGET:50 = EXP:RESULT:50
	EXP:TARGET:51 = EXP:RESULT:51
	EXP:TARGET:52 = EXP:RESULT:52
	EXP:TARGET:53 = EXP:RESULT:53
	EXP:TARGET:54 = EXP:RESULT:54
	EXP:TARGET:55 = EXP:RESULT:55
	EXP:TARGET:56 = EXP:RESULT:56
	EXP:TARGET:60 = EXP:RESULT:60
	EXP:TARGET:61 = EXP:RESULT:61
	EXP:TARGET:62 = EXP:RESULT:62
	EXP:TARGET:63 = EXP:RESULT:63
	EXP:TARGET:64 = EXP:RESULT:64
	EXP:TARGET:70 = EXP:RESULT:70
	ABL:TARGET:3 = ABL:RESULT:3
	ABL:TARGET:4 = ABL:RESULT:4
	ABL:TARGET:5 = ABL:RESULT:5
	ABL:TARGET:6 = ABL:RESULT:6
	PRINTFORMW ＜%NAME:RESULT%は調教の記憶を失った＞
	DELCHARA RESULT
	TARGET = CHARANUM-1
	CALL CLOTHES_INITIALIZE
ENDIF

;排卵誘発剤
IF BOUGHT == 91
	PRINTFORMW ＜%NAME:RESULT%に排卵誘発剤を使った＞
	CFLAG:RESULT:109 = 1
ENDIF

;子宮内避妊結界
IF BOUGHT == 92
	PRINTFORMW ＜%NAME:RESULT%に子宮内避妊結界を使った＞
	CFLAG:RESULT:108 = 1
ENDIF

;アイテムによる崩壊の処理
SIF CFLAG:RESULT:10 >= 100 && TALENT:RESULT:9 == 0
	CALL COLLAPSE_MIND_ITEM

RETURN 0


;産卵イベント　イメージとしては、非常にリスキーだが上手くやれば妊娠を無効にできるイベント
@LAY_EGG
;イベント口上
U = 0
IF ASSI >= 0
	SIF ASSI == RESULT
		U = 1
ENDIF
T = TARGET
TARGET = RESULT
TFLAG:13 = 10
RESULT = TARGET
T = TARGET
SIF U
	ASSI = RESULT

PRINTFORMW 卵を産んだ途端、%NAME:RESULT%のお腹は妊娠する前の大きさに戻った
PRINTFORMW %NAME:RESULT%は[%TALENTNAME:153%]を失った
TALENT:RESULT:153 = 0
;妊娠イベントで減った体力の最大値が回復（少なめ）
MAXBASE:RESULT:0 += 300
;胸の縮小処理を実行
PRINTW また、胸の大きさも小さくなったようだ
C = RESULT
CALL REVERSE_B_SIZE
CALL CLEAR_FLAG

RESULT = A
;ストレス値の補正の決定
;ABL:従順をみる
IF ABL:RESULT:0 == 0
	A = 0
ELSEIF ABL:RESULT:0 == 1
	A = 2
ELSEIF ABL:RESULT:0 == 2
	A = 4
ELSEIF ABL:RESULT:0 == 3
	A = 6
ELSEIF ABL:RESULT:0 == 4
	A = 8
ELSE
	A = 10
ENDIF

;ABL:Ｖ感覚をみる
IF ABL:RESULT:4 == 0
	B = 0
ELSEIF ABL:RESULT:4 == 1
	B = 2
ELSEIF ABL:RESULT:4 == 2
	B = 4
ELSEIF ABL:RESULT:4 == 3
	B = 6
ELSEIF ABL:RESULT:4 == 4
	B = 8
ELSE
	B = 10
ENDIF

;EXP:Ｖ経験をみる
IF EXP:RESULT:0 < EXPLV:1
	C = 0
ELSEIF EXP:RESULT:0 < EXPLV:2
	C = 2
ELSEIF EXP:RESULT:0 < EXPLV:3
	C = 4
ELSEIF EXP:RESULT:0 < EXPLV:4
	C = 6
ELSEIF EXP:RESULT:0 < EXPLV:5
	C = 8
ELSE
	C = 10
ENDIF

;EXP:出産経験をみる
IF EXP:RESULT:60 < EXPLV:2
	D = 100
ELSEIF EXP:RESULT:60 < EXPLV:4
	D = 60
ELSEIF EXP:RESULT:60 < EXPLV:5
	D = 40
ELSE
	D = 20
ENDIF

;陥落素質を見る
SIF TALENT:RESULT:3
	E = 120
SIF TALENT:RESULT:4
	E = 80
SIF TALENT:RESULT:5
	E = 60
SIF TALENT:RESULT:6
	E = 150
SIF TALENT:RESULT:7
	E = 60
SIF TALENT:RESULT:8
	E = 40
SIF TALENT:RESULT:9
	E = 0

F = D*(100-A+B+C)*E/10000

EXP:RESULT:0 += 5
EXP:RESULT:52 += 1
EXP:RESULT:60 += 1
PRINTL Ｖ経験＋５
PRINTL Ｖ拡張経験＋１
PRINTL 出産経験＋１
IF EXP:RESULT:60 == 1 && EXP:RESULT:52 == 1
	EXP:RESULT:50 += 3
	PRINTFORML 異常経験＋3
ELSEIF EXP:RESULT:60 == 1
	EXP:RESULT:50 += 2
	PRINTFORML 異常経験＋2
ELSEIF EXP:RESULT:52 == 1
	EXP:RESULT:50 += 1
	PRINTFORML 異常経験＋1
ENDIF
CFLAG:RESULT:10 += F
BASE:RESULT:0 = 10
SIF CFLAG:RESULT:10 >= 100 && TALENT:RESULT:9 == 0
	CALL COLLAPSE_MIND_ITEM

PRINTFORMW %NAME:RESULT%は体力を激しく消耗している
PRINTFORMW 少し休ませたほうがよさそうだ
;休憩フラグを立てる
FLAG:0 = 1
BEGIN TURNEND


;アイテムで【崩壊】を得た場合のイベント
@COLLAPSE_MIND_ITEM
PRINTFORMW %CALLNAME:RESULT%の様子がおかしい
PRINTFORMW 投薬の影響によって、%CALLNAME:RESULT%の精神に異常をきたしてしまったようだ
PRINTFORMW %NAME:RESULT%は【崩壊】してしまった
TALENT:RESULT:9 = 1
IF TALENT:RESULT:3 || TALENT:RESULT:4 || TALENT:RESULT:5 || TALENT:RESULT:6 || TALENT:RESULT:7 || TALENT:RESULT:8
	PRINTFORM %CALLNAME:RESULT%は[
	SIF TALENT:RESULT:3
		PRINTS TALENTNAME:3
	SIF TALENT:RESULT:4
		PRINTS TALENTNAME:4
	SIF TALENT:RESULT:5
		PRINTS TALENTNAME:5
	SIF TALENT:RESULT:6
		PRINTS TALENTNAME:6
	SIF TALENT:RESULT:7
		PRINTS TALENTNAME:7
	SIF TALENT:RESULT:8
		PRINTS TALENTNAME:8
	PRINTW ]を失った
	SIF TALENT:RESULT:3
		TALENT:RESULT:3 = 0
	SIF TALENT:RESULT:4
		TALENT:RESULT:4 = 0
	SIF TALENT:RESULT:5
		TALENT:RESULT:5 = 0
	SIF TALENT:RESULT:6
		TALENT:RESULT:6 = 0
	SIF TALENT:RESULT:7
		TALENT:RESULT:7 = 0
	SIF TALENT:RESULT:8
		TALENT:RESULT:8 = 0
ENDIF

